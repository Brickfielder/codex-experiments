---
import BaseLayout from '~/layouts/BaseLayout.astro';
import CollaboratorMap from '~/components/collaborate/CollaboratorMap';
import CollaboratorDirectory from '~/components/collaborate/CollaboratorDirectory';
import collaboratorData from '../../data/resuscitation-network-people.json';
import type { Collaborator } from '~/utils/types';

const { people = [], meta } = collaboratorData as {
  people: Collaborator[];
  meta: { updated_at?: string };
};
const totalCountries = new Set(people.map((person) => person.country)).size;
const highlightedTags = [
  'cognition',
  'psychological-support',
  'quality-of-life',
  'return-to-work',
  'family'
];

const filters = [
  { label: 'Cognition', slug: 'cognition' },
  { label: 'Psychological support', slug: 'psychological-support' },
  { label: 'Quality of life', slug: 'quality-of-life' },
  { label: 'Return to work', slug: 'return-to-work' },
  { label: 'Family & co-survivors', slug: 'family' },
  { label: 'Registry analyses', slug: 'registry' }
];

const qaItems = [
  {
    question: 'Why was the map of survivorship created?',
    answer:
      'To connect survivors, co-survivors, clinicians, and researchers working on life after OHCA. Visibility reduces duplication, speeds collaboration, and supports guideline and service development.'
  },
  {
    question: 'What does the map show?',
    answer:
      'Pins for people and groups active in survivorship: research labs, clinical services, survivor-led organisations. Each pin links to a profile covering role, institution, country/region, and a short summary.'
  },
  {
    question: 'What is the content and sources on which the map is based?',
    answer:
      'Primarily self-submitted entries reviewed by editors, plus publicly available information from institutional pages, publications, and conference programmes. Each entry notes the source and last update.'
  },
  {
    question: 'How can I make an entry on the map myself?',
    answer:
      'Use the “Add your entry” button to send details or submit a pull request for data/resuscitation-network-people.json. The editors check scope and consent, then publish the update.'
  }
];
---

<BaseLayout
  title="Collaborate on survivorship science"
  description="Map, directory, and Q&A for the survivorship & co-survivorship network"
>
  <section class="space-y-12 px-4 py-12 sm:px-6 lg:px-8">
    <div
      class="page-hero relative overflow-hidden rounded-3xl border border-white/60 bg-gradient-to-br from-indigo-600 via-violet-500 to-rose-400 p-10 text-white shadow-2xl"
    >
      <div class="absolute inset-0 opacity-30" aria-hidden>
        <div
          class="h-full w-full bg-[radial-gradient(circle_at_top,_rgba(255,255,255,0.2),_transparent_70%)]"
        >
        </div>
      </div>
      <div class="relative grid gap-10 lg:grid-cols-[1.1fr,0.9fr]">
        <div class="space-y-6">
          <p class="text-sm font-semibold uppercase tracking-[0.4em] text-white/80">
            Collaborator hub
          </p>
          <h1 class="text-4xl font-semibold leading-tight">
            Connecting the people improving life after cardiac arrest
          </h1>
          <p class="text-lg text-white/90">
            Discover researchers, clinicians, survivors, and co-survivors. Find collaborators, share
            ideas, and accelerate survivorship science and services across borders.
          </p>
          <div class="page-hero-actions flex flex-wrap gap-3">
            <a
              class="inline-flex items-center gap-2 rounded-2xl bg-white/90 px-5 py-2.5 text-sm font-semibold text-indigo-700 shadow-lg transition hover:-translate-y-0.5 hover:bg-white"
              href="#map"
            >
              View the map
            </a>
            <a
              class="inline-flex items-center gap-2 rounded-2xl bg-white/15 px-5 py-2.5 text-sm font-semibold text-white/90 shadow-lg ring-1 ring-white/40 transition hover:-translate-y-0.5 hover:bg-white/25"
              href="#directory"
            >
              Explore the directory
            </a>
            <a
              class="inline-flex items-center gap-2 rounded-2xl bg-rose-500 px-5 py-2.5 text-sm font-semibold text-white shadow-lg transition hover:-translate-y-0.5 hover:bg-rose-400"
              href="mailto:ohcacare@gmail.com?subject=Add%20me%20to%20the%20OHCA%20survivorship%20map"
            >
              Add your entry
            </a>
          </div>
        </div>
        <div class="rounded-2xl border border-white/20 bg-white/5 p-6 shadow-inner backdrop-blur">
          <h2 class="text-lg font-semibold">Network snapshot</h2>
          <dl class="mt-6 space-y-4 text-sm">
            <div class="flex items-baseline justify-between">
              <dt class="text-white/70">Collaborators</dt>
              <dd class="text-3xl font-semibold">{people.length}</dd>
            </div>
            <div class="flex items-baseline justify-between">
              <dt class="text-white/70">Countries</dt>
              <dd class="text-3xl font-semibold">{totalCountries}</dd>
            </div>
            <div class="flex items-baseline justify-between">
              <dt class="text-white/70">Last update</dt>
              <dd class="text-xl font-semibold">{meta?.updated_at ?? '—'}</dd>
            </div>
          </dl>
        </div>
      </div>
    </div>

    <section
      id="map"
      class="space-y-6 rounded-3xl border border-white/70 bg-white/95 p-8 shadow-xl"
    >
      <header class="space-y-3">
        <p class="text-sm font-semibold uppercase tracking-[0.4em] text-indigo-600">Global map</p>
        <h2 class="text-3xl font-semibold text-slate-900">
          Where survivorship and co-survivorship work is happening
        </h2>
        <p class="text-base text-slate-600">
          Explore who is working on survivorship around the world. Filter by specialty or use the
          directory to focus on names, organisations, job roles, and countries.
        </p>
      </header>
      <div class="flex flex-wrap gap-3">
        {
          filters.map((filter) => (
            <span
              key={filter.slug}
              class={`rounded-full border px-4 py-1 text-xs font-semibold uppercase tracking-[0.2em] ${highlightedTags.includes(filter.slug) ? 'border-indigo-200 bg-indigo-50 text-indigo-700' : 'border-slate-200 bg-white text-slate-500'}`}
            >
              {filter.label}
            </span>
          ))
        }
      </div>
      <CollaboratorMap client:only="preact" people={people} />
    </section>

    <section
      id="directory"
      class="space-y-6 rounded-3xl border border-white/70 bg-white/95 p-8 shadow-xl"
    >
      <header class="space-y-3">
        <p class="text-sm font-semibold uppercase tracking-[0.4em] text-indigo-600">Directory</p>
        <h2 class="text-3xl font-semibold text-slate-900">Researchers & collaborators</h2>
        <p class="text-base text-slate-600">
          Search by name, organisation, tags, or country. Use the specialty chips to narrow the
          list.
        </p>
      </header>
      <CollaboratorDirectory client:load people={people} />
    </section>

    <section
      class="rounded-3xl border border-indigo-100 bg-indigo-50/70 p-8 text-indigo-900 shadow-lg"
    >
      <div class="flex flex-col gap-6 lg:flex-row lg:items-center lg:justify-between">
        <div>
          <p class="text-sm font-semibold uppercase tracking-[0.4em]">Call for entries</p>
          <h3 class="mt-3 text-2xl font-semibold">Are you active in survivorship research?</h3>
          <p class="mt-2 text-base text-indigo-800">
            If you cannot find yourself on the map, send your details. We will review the scope and
            publish your entry.
          </p>
        </div>
        <a
          class="inline-flex items-center justify-center rounded-2xl bg-rose-600 px-6 py-3 text-sm font-semibold text-white shadow-lg transition hover:-translate-y-0.5 hover:bg-rose-500"
          href="mailto:ohcacare@gmail.com?subject=Add%20me%20to%20the%20OHCA%20survivorship%20map"
        >
          Add yourself to the map
        </a>
      </div>
    </section>

    <section id="qa" class="space-y-6 rounded-3xl border border-white/70 bg-white/95 p-8 shadow-xl">
      <header class="space-y-3">
        <p class="text-sm font-semibold uppercase tracking-[0.4em] text-indigo-600">
          Questions & answers
        </p>
        <h2 class="text-3xl font-semibold text-slate-900">Map scope and stewardship</h2>
        <p class="text-base text-slate-600">
          This list does not claim to be complete, nor can accuracy or topicality be guaranteed.
        </p>
      </header>
      <div class="space-y-4">
        {
          qaItems.map((item) => (
            <details
              key={item.question}
              class="rounded-2xl border border-slate-200 bg-white p-4 text-slate-700 shadow-sm"
            >
              <summary class="cursor-pointer text-base font-semibold text-slate-900">
                {item.question}
              </summary>
              <p class="mt-2 text-sm text-slate-600">{item.answer}</p>
            </details>
          ))
        }
      </div>
    </section>

    <section class="rounded-3xl border border-slate-200 bg-slate-900 p-8 text-slate-100 shadow-xl">
      <div class="space-y-4">
        <h2 class="text-2xl font-semibold">Data and stewardship</h2>
        <p class="text-base text-slate-300">
          Data notice: entries are published with consent; removal or edit requests are honoured.
          Contact <a class="text-white underline" href="mailto:ohcacare@gmail.com"
            >ohcacare@gmail.com</a
          >.
        </p>
        <p class="text-sm text-slate-400">
          Content licensed CC BY 4.0 unless noted. Source data: <code
            class="rounded bg-slate-800 px-2 py-1 text-xs"
            >data/resuscitation-network-people.json</code
          >.
        </p>
      </div>
    </section>
  </section>
</BaseLayout>
