---
import BaseLayout from '../layouts/BaseLayout.astro';
import BrowseClient from '../components/browse/BrowseClient.tsx';
import papers from '../../data/papers.normalized.json';
import type { Paper } from '~/utils/types';
const typedPapers = papers as Paper[];
---

<BaseLayout
  title="Browse papers"
  description="Searchable repository of OHCA survivorship literature"
>
  <main class="space-y-10">
    <section
      id="survivorship-hero"
      class="rounded-3xl border border-white/70 bg-white/90 p-8 shadow-2xl ring-1 ring-indigo-100 backdrop-blur"
    >
      <h1 class="text-4xl font-semibold tracking-tight text-slate-900 sm:text-5xl">
        Survivorship After Cardiac Arrest: A Living Research Repository
      </h1>
      <p class="mt-4 text-lg leading-relaxed text-slate-700">
        <strong>Mapping the evidence that tells us what life looks like <em>after</em> survival.</strong>
        <br />
        A curated, continuously updated collection of studies on cognitive, psychological, social, and quality-of-life
        outcomes following cardiac arrest.
      </p>
    </section>

    <section
      id="survivorship-methods"
      class="space-y-6 rounded-3xl border border-white/70 bg-white/90 p-8 shadow-2xl ring-1 ring-indigo-100 backdrop-blur"
    >
      <div class="space-y-4">
        <p class="text-sm font-semibold uppercase tracking-[0.25em] text-indigo-600">Narrative PRISMA-Style Summary</p>
        <h2 class="text-2xl font-semibold text-slate-900">How we built the Survivorship Repository</h2>
        <p class="text-base leading-relaxed text-slate-700">
          To build a comprehensive and up-to-date repository of research on
          <strong>survivorship and co-survivorship after out-of-hospital cardiac arrest</strong>, we conducted a structured
          literature search across three major scientific databases: <strong>PubMed</strong>, <strong>CINAHL</strong>, and
          <strong>Web of Science</strong>. The overarching aim of this project is to increase visibility for survivorship
          research and provide the scientific community with a centralised, openly accessible collection of the work
          published over the past five years.
        </p>
      </div>

      <details
        class="survivorship-drawer space-y-3 rounded-2xl border border-slate-200 bg-white/80 p-5 text-slate-700 shadow-inner"
        open
      >
        <summary class="cursor-pointer text-lg font-semibold text-slate-900">Identification</summary>
        <p>
          A tailored search strategy&mdash;published in full for transparency and replicability&mdash;was applied to each
          database. Together, these searches returned a large pool of records spanning medical, nursing, psychological,
          and rehabilitation sciences. For each record, <strong>titles and abstracts were retrieved</strong>, except in cases
          where the abstract was unavailable in the source database. You can access the full search strategy here:
          <a class="text-indigo-600 underline" href="/path/to/search-strategy.pdf">detailed search strategy (replicable)</a>.
        </p>
      </details>

      <details class="survivorship-drawer space-y-3 rounded-2xl border border-slate-200 bg-white/80 p-5 text-slate-700 shadow-inner">
        <summary class="cursor-pointer text-lg font-semibold text-slate-900">Deduplication</summary>
        <p>
          All records were merged into a single dataset. Using a custom <strong>Python-based deduplication script</strong>,
          duplicate entries were identified and removed through a combination of DOI matching, fuzzy title comparison, and
          metadata harmonisation. The deduplicated set represented the total pool of unique publications eligible for
          initial screening. The deduplication script is available here:
          <a class="text-indigo-600 underline" href="/path/to/deduplication-script.py">deduplication Python script</a>.
        </p>
      </details>

      <details class="survivorship-drawer space-y-3 rounded-2xl border border-slate-200 bg-white/80 p-5 text-slate-700 shadow-inner">
        <summary class="cursor-pointer text-lg font-semibold text-slate-900">Semantic Prioritisation</summary>
        <p>
          To support efficient human review, abstracts were processed using a
          <strong>sentence-transformer semantic model (all-MiniLM-L6-v2)</strong>. Each record received a semantic relevance
          score reflecting its conceptual proximity to the defined survivorship domain. Papers were then
          <strong>rank-ordered from most to least semantically aligned</strong>, but <strong>no automatic exclusions were
          made</strong>; this step was designed purely to structure workflow, not to determine eligibility. In practice, this
          semantic system tends to <strong>rank down studies focused exclusively on neuroprognostication, bystander
          interventions, survival-only registry analyses, or simulation/education studies</strong>, while prioritising work
          addressing cognitive, psychological, social, and quality-of-life outcomes. The semantic screening script is
          available here:
          <a class="text-indigo-600 underline" href="/path/to/semantic-screening-script.py">semantic screening Python script</a>.
        </p>
      </details>

      <details class="survivorship-drawer space-y-3 rounded-2xl border border-slate-200 bg-white/80 p-5 text-slate-700 shadow-inner">
        <summary class="cursor-pointer text-lg font-semibold text-slate-900">Screening</summary>
        <p>
          Two independent reviewers manually screened every abstract <strong>one by one</strong>, starting from the highest-ranked
          records. Eligibility was determined based on predefined <strong>Population / Intervention / Outcomes (P/I/O)</strong>
          criteria specific to survivorship after cardiac arrest, covering cognitive, psychological, social, and quality-of-life
          domains. Where needed, full texts were consulted to clarify eligibility.
        </p>
      </details>

      <details class="survivorship-drawer space-y-3 rounded-2xl border border-slate-200 bg-white/80 p-5 text-slate-700 shadow-inner">
        <summary class="cursor-pointer text-lg font-semibold text-slate-900">Inclusion</summary>
        <p>
          Studies meeting inclusion criteria were added to the Survivorship Repository, with metadata harmonised across all
          sources. Links to full texts (where available), DOIs, and abstracts were preserved to maximise accessibility. For
          methodological transparency, we provide the <strong>Python scripts</strong> used for deduplication and semantic
          scoring, along with the <strong>search strategy documents</strong>, so that other groups can replicate or adapt this
          workflow for their own contexts.
        </p>
      </details>
    </section>

    {
      /*
        IMPORTANT:
        - Below this comment, KEEP the existing code that renders the survivorship papers list,
          filters, tables, or cards. Do not remove or change that logic.
        - Only the hero + methods explanation above should be new.
      */
    }

    <div
      class="rounded-3xl border border-white/70 bg-white/95 p-6 shadow-2xl ring-1 ring-indigo-100 backdrop-blur"
    >
      <BrowseClient client:load papers={typedPapers} />
    </div>
  </main>
</BaseLayout>
